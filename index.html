<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Game</title>
        <script type="text/javascript" src="phaser.min.js"></script>
		<style type="text/css">
			body {
				margin: 0;
			}
		</style>
    </head>
    <body>
		<script type="text/javascript">
			var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update, render: render });
			var platforms;
			var cursors;
			var player;
			var last;
			var bot;
			var items;
			var snakePath=new Array();
			var snakeSection=new Array();//snake body
			function preload () {

				game.load.image('background', 'backg.png');
				game.load.image('aub', 'aubergine.png');
				game.load.image('broc', 'broccoli.png');
				game.load.image('platform', 'platform.png');
				game.load.image('square', 'square.png');
				game.load.spritesheet('head', 'head.png');//head of snake

			}

			function create () {

				//  We're going to be using physics, so enable the Arcade Physics system
				game.physics.startSystem(Phaser.Physics.ARCADE);
	 
				//  A simple background for our game
				game.add.sprite(0, 0, 'background');
	 
				//  The platforms group contains the ground and the 2 ledges we can jump on
				platforms = game.add.group();
			 
				//  We will enable physics for any object that is created in this group
				platforms.enableBody = true;
			 
				
				items=game.add.group();
				items.enableBody=true;
				
				for(var i=0; i<5;i++)
				{
					var aub=items.create(giveX(),giveY(),'aub');
					var str = "aubx="+aub.x+" auby="+aub.y;
					console.log(str); // Write the string to a file
					var broc=items.create(giveX(),giveY(),'broc');
					var str = "aubx="+broc.x+" auby="+broc.y;
					console.log(str); // Write the string to a file
				}
				
				// The player and its settings
				player = game.add.sprite(32, game.world.height - 150, 'head');
				
				//  We need to enable physics on the player
				game.physics.arcade.enable(player);
				game.physics.arcade.allowGravity=false;
				//  Player physics properties. Give the little guy a slight bounce.
				player.body.bounce.y = 0;
				//player.body.gravity.y = 0;
				player.body.bounce.x = 0;
				//player.body.gravity.x = 0;
				player.body.collideWorldBounds = true;
				player.body.damping=0;

				//  Our two animations, walking left and right.
				//player.animations.add('head', [0, 1, 2, 3], 10, true);
				//player.animations.add('head', [5, 6, 7, 8], 10, true);
				player.animations.add('run');
				//control
				cursors=game.input.keyboard.createCursorKeys();
				player.body.acceleration=0;
				
				
				
			}
			var speed=0;
			
			function update() {
				//  Collide the player and the stars with the platforms
				//game.physics.arcade.collide(player, platforms);

				//  Reset the players velocity (movement)
				player.body.velocity.x = 0;
				player.body.velocity.y=0;
				game.physics.arcade.collide(items, platforms);
				game.physics.arcade.overlap(player, items, collectItem, null, this);
				
				
				if (cursors.left.isDown)
				{
					//  Move to the left
					
					player.body.velocity.x -= (150+speed*15);
					player.body.velocity.y=0;
					//player.animations.play('head');
					last="left";
					
				}
				else if (cursors.right.isDown)
				{
					//  Move to the right
					player.body.velocity.x += (150+speed*15);
					player.body.velocity.y=0;
					//player.animations.play('right');
					last="right";
					
				}
				else if (cursors.up.isDown){
				//  Move to the up
					player.body.velocity.x = 0;
					player.body.velocity.y -= (150+speed*15);
					//player.animations.play('up');
					last="up";
				}
				else if (cursors.down.isDown){
				//  Move to the down
					player.body.velocity.x = 0;
					player.body.velocity.y += (150+speed*15);
					//player.animations.play('down');
					last="down";
				}
				else if(last=="left"){
					player.body.velocity.x -= (150+speed*15);
					player.body.velocity.y=0;
					player.animations.play('left');
				}
				else if(last=="right"){
					player.body.velocity.x += (150+speed*15);
					player.body.velocity.y=0;
					player.animations.play('right');
				}
				else if(last=="up"){
					player.body.velocity.y -= (150+speed*15);
					player.body.velocity.x=0;
					player.animations.play('up');
				}
				else if(last=="down"){
					player.body.velocity.y += (150+speed*15);
					player.body.velocity.x=0;
					player.animations.play('down');
				}
				else{
					player.animations.stop();
					
					player.frame = 4;
					}
				
				
				//  Allow the player to jump if they are touching the ground.
				/*if (cursors.up.isDown && player.body.touching.down)
				{
					player.body.velocity.y = -350;
				}*/
				if(snakePath.length>0 && snakeSection.length>0){
					var part = snakePath.pop();

					part.setTo(player.x, player.y);

					snakePath.unshift(part);
					var j=snakePath.length;
					console.log("snake length="+j+" speed="+speed);
					for (var i = 0; i < j; i++)
					{
						console.log(i);
						snakeSection[i].x = snakePath[i].x;
						snakeSection[i].y = snakePath[i].y;
					}
				}
			}
			
			function moveSnake(player){
				var x=player.x;
				var y=player.y;
				var i=speed;
				for(j=0;j<=i;j++){
					
				}
				
				
			}
			
			function snakeBody(player){
				var x=player.x+player.width;
				var y=player.y;
				
				snakePath[speed]=new Phaser.Point(x,y);
				snakeSection[speed]=game.add.sprite(x+60, y+30, 'square');
				//snakePath.pop();
				console.log("new snakeSection created");
				game.physics.arcade.enable(snakeSection[speed]);
				snakeSection[speed].body.collideWorldBounds = true;
				
			}
			function collectItem(player, items){
				items.kill();
				//snakeSection[speed]=game.add.sprite(player.
				
				snakeBody(player);
				speed++;
				
			}
			function giveX(){
				var x=Math.floor(Math.random()*800);
				if (x<=30) x=30;
				if (x>=770) x=770;
				return x;
			}
			function giveY(){
				var y=Math.floor(Math.random()*600);
				if (y<=30) y=30;
				if (y>=570) y=570;
				return y;
			}
			function render(){
				game.debug.spriteInfo(player, 32, 32);
			}

		</script>


    </body>
</html>