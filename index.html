<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Game</title>
        <script type="text/javascript" src="phaser.min.js"></script>
		<style type="text/css">
			body {
				margin: 0;
			}
		</style>
    </head>
    <body>
		<script type="text/javascript">
			var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });
			var platforms;
			var cursors;
			var player;
			var last;
			var bot;
			var items;
			function preload () {

				game.load.image('background', 'backg.png');
				game.load.image('aub', 'aubergine.png');
				game.load.image('broc', 'broccoli.png');
				game.load.image('platform', 'platform.png');
				game.load.image('square', 'square.png');
				game.load.spritesheet('head', 'head.png');

			}

			function create () {

				//  We're going to be using physics, so enable the Arcade Physics system
				game.physics.startSystem(Phaser.Physics.ARCADE);
	 
				//  A simple background for our game
				game.add.sprite(0, 0, 'background');
	 
				//  The platforms group contains the ground and the 2 ledges we can jump on
				platforms = game.add.group();
			 
				//  We will enable physics for any object that is created in this group
				platforms.enableBody = true;
			 
				// Here we create the ground.
				//var ground = platforms.create(0, game.world.height - 64, 'platform');
			 
				//  Scale it to fit the width of the game (the original sprite is 400x32 in size)
				//ground.scale.setTo(2, 2);
			 
				//  This stops it from falling away when you jump on it
				//ground.body.immovable = true;
			 
				//  Now let's create two ledges
				/*var ledge = platforms.create(400, 200, 'platform');
			 
				ledge.body.immovable = true;
			 
				ledge = platforms.create(20, 350, 'platform');
			 
				ledge.body.immovable = true;*/
				items=game.add.group();
				items.enableBody=true;
				for(var i=0; i<5;i++)
				{
					var aub=items.create(Math.floor(Math.random()*800-20*i),Math.floor(Math.random()*600),'aub');
					var broc=items.create(Math.floor(Math.random()*800-20*i),Math.floor(Math.random()*600),'broc');
				}
				
				// The player and its settings
				player = game.add.sprite(32, game.world.height - 150, 'head');
				
				//  We need to enable physics on the player
				game.physics.arcade.enable(player);
				game.physics.arcade.allowGravity=false;
				//  Player physics properties. Give the little guy a slight bounce.
				player.body.bounce.y = 0;
				//player.body.gravity.y = 0;
				player.body.bounce.x = 0;
				//player.body.gravity.x = 0;
				player.body.collideWorldBounds = true;
				player.body.damping=0;

				//  Our two animations, walking left and right.
				//player.animations.add('head', [0, 1, 2, 3], 10, true);
				//player.animations.add('head', [5, 6, 7, 8], 10, true);
				player.animations.add('run');
				//control
				cursors=game.input.keyboard.createCursorKeys();
				player.body.acceleration=0;
				
				
				
			}
		
			function update() {
				//  Collide the player and the stars with the platforms
				//game.physics.arcade.collide(player, platforms);

				//  Reset the players velocity (movement)
				player.body.velocity.x = 0;
				player.body.velocity.y=0;
				game.physics.arcade.collide(items, platforms);
				game.physics.arcade.overlap(player, items, collectItem, null, this);
				
				
				if (cursors.left.isDown)
				{
					//  Move to the left
					player.body.velocity.x -= 150;
					player.body.velocity.y=0;
					//player.animations.play('head');
					last="left";
					
				}
				else if (cursors.right.isDown)
				{
					//  Move to the right
					player.body.velocity.x += 150;
					player.body.velocity.y=0;
					//player.animations.play('right');
					last="right";
					
				}
				else if (cursors.up.isDown){
				//  Move to the up
					player.body.velocity.x = 0;
					player.body.velocity.y -= 112.5;
					//player.animations.play('up');
					last="up";
				}
				else if (cursors.down.isDown){
				//  Move to the down
					player.body.velocity.x = 0;
					player.body.velocity.y += 112.5;
					//player.animations.play('down');
					last="down";
				}
				else if(last=="left"){
					player.body.velocity.x -= 150;
					player.body.velocity.y=0;
					player.animations.play('left');
				}
				else if(last=="right"){
					player.body.velocity.x += 150;
					player.body.velocity.y=0;
					player.animations.play('right');
				}
				else if(last=="up"){
					player.body.velocity.y -= 112.5;
					player.body.velocity.x=0;
					player.animations.play('up');
				}
				else if(last=="down"){
					player.body.velocity.y += 112.5;
					player.body.velocity.x=0;
					player.animations.play('down');
				}
				else{
					player.animations.stop();
					
					player.frame = 4;
					}
				
				
				//  Allow the player to jump if they are touching the ground.
				/*if (cursors.up.isDown && player.body.touching.down)
				{
					player.body.velocity.y = -350;
				}*/

			}
			function collectItem(player, items){
				items.kill();
			}


		</script>


    </body>
</html>